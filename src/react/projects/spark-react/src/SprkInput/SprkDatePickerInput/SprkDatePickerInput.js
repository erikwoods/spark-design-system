import React, { Component } from 'react';
import PropTypes from 'prop-types';
import { assign } from 'lodash';
import SprkTextInput from '../SprkTextInput/SprkTextInput';

class SprkDatePickerInput extends Component {
  constructor(props) {
    super(props).datePickerInputRef = React.createRef();
    this.tdpConfig = {
      mode: 'dp-below',
      lang: {
        days: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
      },
      min: '01/1/2008',
      max: '01/1/2068',
      format: date =>
        date
          .toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric',
          })
          .replace(/[^ -~]/g, ''),
    };
  }

  componentDidMount() {
    import(/* webpackChunkName: "tiny-date-picker" */ 'tiny-date-picker')
      .then(({ default: TinyDatePicker }) => {
        const { datePickerConfig } = this.props;
        TinyDatePicker(
          this.datePickerInputRef.current,
          assign(this.tdpConfig, datePickerConfig),
        );
      })
      .catch(error => 'An error occurred while loading the component');
  }

  render() {
    const { datePickerConfig, ...rest } = this.props;
    return <SprkTextInput forwardedRef={this.datePickerInputRef} {...rest} />;
  }
}

SprkDatePickerInput.propTypes = {
  datePickerConfig: PropTypes.shape({
    appendTo: PropTypes.node,
    lang: PropTypes.shape({
      days: PropTypes.arrayOf(PropTypes.string),
      months: PropTypes.arrayOf(PropTypes.string),
    }),
    today: PropTypes.string,
    clear: PropTypes.string,
    close: PropTypes.string,
    format: PropTypes.func,
    parse: PropTypes.func,
    mode: PropTypes.oneOf(['dp-modal', 'dp-below', 'dp-permanent']),
    hilightedDate: PropTypes.string,
    min: PropTypes.string,
    max: PropTypes.string,
    inRange: PropTypes.func,
    dateClass: PropTypes.func,
    dayOffset: PropTypes.number,
  }),
};

SprkDatePickerInput.defaultProps = {
  datePickerConfig: {},
};

export default SprkDatePickerInput;
